-- MainScript.lua

-- Подгрузка библиотеки по ссылке
local Lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/Alkaesh/fddfdffdssadsdadasdasdsagfdgghfhgf/refs/heads/main/robloxlib.lua"))()

-- Подгрузка ESP-модуля
local ESP
local success, err = pcall(function()
    ESP = loadstring(game:HttpGet("https://raw.githubusercontent.com/Alkaesh/fddfdffdssadsdadasdasdsagfdgghfhgf/refs/heads/main/esp-modul"))()
end)
if not success or not ESP then
    Lib.Menu:Notify("Failed to load ESP module! Error: " .. (err or "Unknown error"), 5)
else
    Lib.Menu:Notify("ESP module loaded successfully", 3)
end

-- Подгрузка Fly-модуля
local Fly
local success, err = pcall(function()
    Fly = loadstring(game:HttpGet("https://raw.githubusercontent.com/Alkaesh/fddfdffdssadsdadasdasdsagfdgghfhgf/refs/heads/main/fly-modul"))()
end)
if not success or not Fly then
    Lib.Menu:Notify("Failed to load Fly module! Error: " .. (err or "Unknown error"), 5)
else
    Lib.Menu:Notify("Fly module loaded successfully", 3)
end

-- Основные сервисы
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Создаем меню
local menu = Lib.Menu:CreateMenu("My Cheat")

-- Вкладки
local mainTab = Lib.Menu:AddTab(menu, "Main")
local teleportTab = Lib.Menu:AddTab(menu, "Teleport")
local espTab = ESP and Lib.Menu:AddTab(menu, "ESP") -- Создаем вкладку ESP только если модуль загрузился

-- Переменные для функционала
local speedEnabled = false
local jumpEnabled = false
local sliderSpeed = 16 -- Значение слайдера для скорости
local sliderJumpPower = 50 -- Значение слайдера для прыжка
local currentSpeed = 16 -- Текущее применяемое значение скорости
local currentJumpPower = 50 -- Текущее применяемое значение прыжка
local defaultSpeed = 16 -- Дефолтное значение скорости (зависит от сервера)
local defaultJumpPower = 50 -- Дефолтное значение прыжка (зависит от сервера)
local teleportOnClickEnabled = false
local Clipon = false
local Stepped
local antiAfkEnabled = false

-- Переменные для управления уведомлениями (debounce)
local lastNotificationTime = 0
local notificationCooldown = 1 -- Задержка между уведомлениями (в секундах)

-- Функция для показа уведомлений с задержкой
local function notifyWithCooldown(message, duration)
    local currentTime = tick()
    if currentTime - lastNotificationTime >= notificationCooldown then
        Lib.Menu:Notify(message, duration)
        lastNotificationTime = currentTime
    end
end

-- Функция для получения персонажа
local function getCharacter(player)
    return player.Character
end

-- Сохраняем начальные значения скорости и прыжка
local function updateDefaultValues()
    local character = getCharacter(LocalPlayer)
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            defaultSpeed = humanoid.WalkSpeed
            defaultJumpPower = humanoid.JumpPower
            if not speedEnabled then
                currentSpeed = defaultSpeed
                sliderSpeed = defaultSpeed
            end
            if not jumpEnabled then
                currentJumpPower = defaultJumpPower
                sliderJumpPower = defaultJumpPower
            end
        end
    end
end

-- Вызываем при загрузке скрипта
updateDefaultValues()

-- Обновляем начальные значения при респавне
LocalPlayer.CharacterAdded:Connect(function(character)
    updateDefaultValues()
    local humanoid = character:WaitForChild("Humanoid")
    if speedEnabled then
        currentSpeed = sliderSpeed
        humanoid.WalkSpeed = currentSpeed
        notifyWithCooldown("Speedhack applied after respawn: " .. currentSpeed, 3)
    else
        humanoid.WalkSpeed = defaultSpeed
    end
    if jumpEnabled then
        currentJumpPower = sliderJumpPower
        humanoid.JumpPower = currentJumpPower
        notifyWithCooldown("Jump Power applied after respawn: " .. currentJumpPower, 3)
    else
        humanoid.JumpPower = defaultJumpPower
    end
end)

-- Постоянное обновление скорости и прыжка
RunService.RenderStepped:Connect(function()
    local character = getCharacter(LocalPlayer)
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            if speedEnabled then
                if humanoid.WalkSpeed ~= currentSpeed then
                    humanoid.WalkSpeed = currentSpeed
                end
            else
                if humanoid.WalkSpeed ~= defaultSpeed then
                    humanoid.WalkSpeed = defaultSpeed
                end
            end
            if jumpEnabled then
                if humanoid.JumpPower ~= currentJumpPower then
                    humanoid.JumpPower = currentJumpPower
                end
            else
                if humanoid.JumpPower ~= defaultJumpPower then
                    humanoid.JumpPower = defaultJumpPower
                end
            end
        end
    end
end)

-- Функция для Anti-AFK
local function toggleAntiAfk(state)
    antiAfkEnabled = state
    if antiAfkEnabled then
        spawn(function()
            while antiAfkEnabled do
                local character = getCharacter(LocalPlayer)
                if character then
                    local rootPart = character:FindFirstChild("HumanoidRootPart")
                    if rootPart then
                        rootPart.CFrame = rootPart.CFrame + Vector3.new(0.1, 0, 0)
                        wait(0.1)
                        rootPart.CFrame = rootPart.CFrame - Vector3.new(0.1, 0, 0)
                    end
                end
                wait(10)
            end
        end)
        Lib.Menu:Notify("Anti-AFK Enabled", 3)
    else
        Lib.Menu:Notify("Anti-AFK Disabled", 3)
    end
end

-- Функция для Noclip
local function toggleNoclip(state)
    Clipon = state
    if Clipon then
        Stepped = RunService.Stepped:Connect(function()
            if Clipon then
                local character = getCharacter(LocalPlayer)
                if character then
                    for _, v in pairs(character:GetChildren()) do
                        if v:IsA("BasePart") then
                            v.CanCollide = false
                        end
                    end
                end
            else
                Stepped:Disconnect()
            end
        end)
    else
        local character = getCharacter(LocalPlayer)
        if character then
            for _, v in pairs(character:GetChildren()) do
                if v:IsA("BasePart") then
                    v.CanCollide = true
                end
            end
        end
        if Stepped then
            Stepped:Disconnect()
        end
    end
end

-- Функция для телепортации к игроку с частичным совпадением ника
local function teleportToPlayer(partialName)
    if not partialName or partialName == "" then
        Lib.Menu:Notify("Please enter a player name!", 3)
        return
    end

    partialName = partialName:lower()
    local matchingPlayers = {}

    for _, player in pairs(Players:GetPlayers()) do
        local playerNameLower = player.Name:lower()
        if playerNameLower:sub(1, #partialName) == partialName then
            table.insert(matchingPlayers, player)
        end
    end

    if #matchingPlayers == 0 then
        Lib.Menu:Notify("No players found with name starting with: " .. partialName, 3)
    elseif #matchingPlayers == 1 then
        local targetPlayer = matchingPlayers[1]
        local character = getCharacter(LocalPlayer)
        local targetCharacter = getCharacter(targetPlayer)
        if character and targetCharacter then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            local targetRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
            if rootPart and targetRootPart then
                rootPart.CFrame = targetRootPart.CFrame
                Lib.Menu:Notify("Teleported to " .. targetPlayer.Name, 3)
            else
                Lib.Menu:Notify("Could not teleport: Player or target has no HumanoidRootPart", 3)
            end
        else
            Lib.Menu:Notify("Could not teleport: Player or target character not found", 3)
        end
    else
        local playerList = "Multiple players found: "
        for i, player in ipairs(matchingPlayers) do
            playerList = playerList .. player.Name
            if i < #matchingPlayers then
                playerList = playerList .. ", "
            end
        end
        Lib.Menu:Notify(playerList .. " - please be more specific.", 5)
    end
end

-- Функция для телепортации по клику (Left Ctrl + Click)
local function teleportToClickPosition()
    local character = getCharacter(LocalPlayer)
    if not character then
        Lib.Menu:Notify("Could not teleport: Character not found", 3)
        return
    end

    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then
        Lib.Menu:Notify("Could not teleport: No HumanoidRootPart found", 3)
        return
    end

    local mouseHit = Mouse.Hit
    if mouseHit then
        local wasClipon = Clipon
        toggleNoclip(true)
        rootPart.CFrame = CFrame.new(mouseHit.Position + Vector3.new(0, 3, 0))
        wait(0.1)
        toggleNoclip(wasClipon)
        Lib.Menu:Notify("Teleported to click position", 2)
    else
        Lib.Menu:Notify("Could not teleport: Invalid click position", 3)
    end
end

-- Обработка Left Ctrl + Click для телепортации
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then return end

    if teleportOnClickEnabled and input.UserInputType == Enum.UserInputType.MouseButton1 then
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
            teleportToClickPosition()
        end
    end
end)

-- Секции и элементы для вкладки Main
Lib.Menu:AddSection(mainTab, "Movement")
Lib.Menu:AddToggle(mainTab, "Enable Speedhack", false, function(state)
    speedEnabled = state
    if state then
        currentSpeed = sliderSpeed
        local character = getCharacter(LocalPlayer)
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = currentSpeed
            end
        end
        Lib.Menu:Notify("Speedhack Enabled", 3)
    else
        currentSpeed = defaultSpeed
        local character = getCharacter(LocalPlayer)
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = defaultSpeed
            end
        end
        Lib.Menu:Notify("Speedhack Disabled", 3)
    end
end)
Lib.Menu:AddSlider(mainTab, "Speed", 16, 100, defaultSpeed, function(value)
    sliderSpeed = value
    if speedEnabled then
        currentSpeed = sliderSpeed
        local character = getCharacter(LocalPlayer)
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = currentSpeed
                notifyWithCooldown("Speed set to " .. value, 3)
            else
                notifyWithCooldown("Speedhack failed: Humanoid not found", 3)
            end
        else
            notifyWithCooldown("Speedhack failed: Character not found", 3)
        end
    else
        notifyWithCooldown("Enable Speedhack to apply speed", 3)
    end
end)
Lib.Menu:AddToggle(mainTab, "Enable Jump Power", false, function(state)
    jumpEnabled = state
    if state then
        currentJumpPower = sliderJumpPower
        local character = getCharacter(LocalPlayer)
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.JumpPower = currentJumpPower
            end
        end
        Lib.Menu:Notify("Jump Power Enabled", 3)
    else
        currentJumpPower = defaultJumpPower
        local character = getCharacter(LocalPlayer)
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.JumpPower = defaultJumpPower
            end
        end
        Lib.Menu:Notify("Jump Power Disabled", 3)
    end
end)
Lib.Menu:AddSlider(mainTab, "Jump Power", 50, 200, defaultJumpPower, function(value)
    sliderJumpPower = value
    if jumpEnabled then
        currentJumpPower = sliderJumpPower
        local character = getCharacter(LocalPlayer)
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.JumpPower = currentJumpPower
                notifyWithCooldown("Jump Power set to " .. value, 3)
            else
                notifyWithCooldown("Jump Power failed: Humanoid not found", 3)
            end
        else
            notifyWithCooldown("Jump Power failed: Character not found", 3)
        end
    else
        notifyWithCooldown("Enable Jump Power to apply jump power", 3)
    end
end)
Lib.Menu:AddToggle(mainTab, "Noclip", false, function(state)
    toggleNoclip(state)
end)

-- Добавляем настройки для Fly (только если модуль загрузился)
if Fly then
    Lib.Menu:AddToggle(mainTab, "Fly", false, function(state)
        local success, message = Fly:ToggleFly(state)
        if success then
            Lib.Menu:Notify(message, 3)
        else
            Lib.Menu:Notify("Error: " .. message, 3)
        end
    end)
    Lib.Menu:AddSlider(mainTab, "Fly Speed", 50, 200, 50, function(value)
        Fly.flySpeed = value
        notifyWithCooldown("Fly Speed set to " .. value, 3)
    end)
end

-- Добавляем Anti-AFK
Lib.Menu:AddSection(mainTab, "Utility")
Lib.Menu:AddToggle(mainTab, "Enable Anti-AFK", false, function(state)
    toggleAntiAfk(state)
end)

-- Секции и элементы для вкладки Teleport
Lib.Menu:AddSection(teleportTab, "Teleport to Player")
local teleportTextBox = Lib.Menu:AddTextBox(teleportTab, "Player Name (First Letters)", "", function(playerName)
    teleportToPlayer(playerName)
end)
Lib.Menu:AddButton(teleportTab, "Teleport", function()
    teleportToPlayer(teleportTextBox.Text)
end)

Lib.Menu:AddSection(teleportTab, "Teleport on Click (Left Ctrl + Click)")
Lib.Menu:AddToggle(teleportTab, "Enable Teleport on Click", false, function(state)
    teleportOnClickEnabled = state
    if state then
        Lib.Menu:Notify("Teleport on Click enabled (Left Ctrl + Click)", 3)
    else
        Lib.Menu:Notify("Teleport on Click disabled", 3)
    end
end)

-- Секции и элементы для вкладки ESP (добавляем только если модуль загрузился)
if ESP then
    Lib.Menu:AddSection(espTab, "ESP Settings")
    Lib.Menu:AddToggle(espTab, "Enable ESP", true, function(state)
        ESP.espEnabled = state
        if state then
            Lib.Menu:Notify("ESP Enabled", 3)
        else
            Lib.Menu:Notify("ESP Disabled", 3)
        end
    end)

    Lib.Menu:AddToggle(espTab, "Enable Team Check", true, function(state)
        ESP.teamCheckEnabled = state
        Lib.Menu:Notify("Team Check " .. (state and "Enabled" or "Disabled"), 3)
    end)

    Lib.Menu:AddToggle(espTab, "Enable Tracers", true, function(state)
        ESP.tracersEnabled = state
        Lib.Menu:Notify("Tracers " .. (state and "Enabled" or "Disabled"), 3)
    end)

    Lib.Menu:AddToggle(espTab, "Tracers From Bottom", false, function(state)
        ESP.tracerFromBottom = state
        Lib.Menu:Notify("Tracers From Bottom " .. (state and "Enabled" or "Disabled"), 3)
    end)

    Lib.Menu:AddSlider(espTab, "ESP Distance", 100, 3000, 3000, function(value)
        ESP.espMaxDistance = value
        notifyWithCooldown("ESP Distance set to " .. value .. " studs", 3)
    end)

    Lib.Menu:AddSlider(espTab, "Box Transparency", 0, 1, 0.5, function(value)
        ESP.boxTransparency = value
        notifyWithCooldown("Box Transparency set to " .. value, 3)
    end)

    Lib.Menu:AddSlider(espTab, "Box Thickness", 0, 0.5, 0.1, function(value)
        ESP.boxThickness = value
        notifyWithCooldown("Box Thickness set to " .. value, 3)
    end)

    Lib.Menu:AddSlider(espTab, "Tracer Thickness", 1, 5, 2, function(value)
        ESP.tracerThickness = value
        notifyWithCooldown("Tracer Thickness set to " .. value, 3)
    end)

    Lib.Menu:AddSlider(espTab, "Text Size", 8, 20, 10, function(value)
        ESP.textSize = value
        notifyWithCooldown("Text Size set to " .. value, 3)
    end)

    Lib.Menu:AddColorPicker(espTab, "Visible Color", ESP.espVisibleColor, function(color)
        ESP.espVisibleColor = color
        Lib.Menu:Notify("Visible ESP color updated", 3)
    end)

    Lib.Menu:AddColorPicker(espTab, "Not Visible Color", ESP.espNotVisibleColor, function(color)
        ESP.espNotVisibleColor = color
        Lib.Menu:Notify("Not Visible ESP color updated", 3)
    end)
end

-- Горячая клавиша для показа/скрытия меню (Right Control)
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightControl then
        if menu.Visible then
            Lib.Menu:HideMenu(menu)
        else
            Lib.Menu:ShowMenu(menu)
        end
    end
end)
